<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Sistem Pemanfaatan Ruang | Kota Yogyakarta</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/Kota_Yogyakarta-logo-828E536380-seeklogo.com.png" rel="icon">
  <link href="assets/img/Kota_Yogyakarta-logo-828E536380-seeklogo.com.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Roboto:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="assets\vendor\aos\aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets\vendor\quill\quill.snow.css" rel="stylesheet">
  <link href="assets\vendor\quill\quill.bubble.css" rel="stylesheet">
  <link href="assets\vendor\remixicon\remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">
  <link href="assets\vendor\glightbox\css\glightbox.css" rel="stylesheet">
  <link href="assets\vendor\remixicon\remixicon.css" rel="stylesheet">
  <link href="assets\vendor\swiper\swiper-bundle.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/ol-ext/dist/ol-ext.min.css" />

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  <link href="assets\css\style_nice.css" rel="stylesheet">
  <link href="assets\css\style_map.css" rel="stylesheet">
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top">
    <div class="container d-flex align-items-center">

      <h1 class="logo me-auto"><a href="beranda.html"><span>Ruang</span>Cerdas</a></h1>
      <!-- Uncomment below if you prefer to use an image logo -->
      <!-- <a href="beranda.html" class="logo me-auto me-lg-0"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->
      <i class="bi bi-list toggle-sidebar-btn"></i>

      <nav id="navbar" class="navbar order-last order-lg-0">
        <ul>
          <li><a href="beranda.html">Beranda</a></li>
          <li><a href="Ruangpedia.html">Ruangpedia</a></li>
          <li><a href="ruangpeta.html" class="active">Ruangpeta</a></li>
          <li><a href="kontak.html">Kontak</a></li>

        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

      <div class="header-social-links d-flex">
        <a href="https://twitter.com/pemkotjogja?lang=en" class="twitter"><i class="bu bi-twitter"
            title="Twitter"></i></a>
        <a href="https://www.facebook.com/humaskotajogja/?locale=id_ID" class="facebook" title="Facebook"><i
            class="bu bi-facebook"></i></a>
        <a href="https://www.instagram.com/pemkotjogja/?hl=en" class="instagram"><i class="bu bi-instagram"
            title="Instagram"></i></a>
      </div>

    </div>
  </header><!-- End Header -->

  <!-- ======= Breadcrumbs ======= -->
  <section id="breadcrumbs" class="breadcrumbs fixed-top">
    <div class="container">

      <div class="d-flex justify-content-between align-items-center">
        <h2>Ruangpeta</h2>
        <ol>
          <li><a href="beranda.html">Beranda</a></li>
          <li><a href="ruangpeta.html">Ruangpeta</a></li>
        </ol>
      </div>

    </div>
  </section><!-- End Breadcrumbs -->

  
  <main id="main" class="main">

    <section class="section dashboard">
      <div class="row">

        <!-------- Main Page -------->
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Peta Lokasi IMB dan SKRK di Kota Yogyakarta</h5>
              <div id="map"></div>
              <div id="popup" class="popup"></div>
              <div class="control-container">
                <div class="controls">
                  <button id="zoom-in" class="btn btn-light"><i class="bi bi-zoom-in" title="Zoom In"></i></button>
                  <button id="zoom-out" class="btn btn-light"><i class="bi bi-zoom-out" title="Zoom Out"></i></button>
                  <button id="fullscreen" class="btn btn-light"><i class="bi bi-fullscreen"
                      title="Fullscreen"></i></button>
                  <button id="geolocate" class="btn btn-light"><i class="bi bi-geo-alt"
                      title="Lokasi Saya"></i></button>
                  <button id="measurement-polygon" class="btn btn-light" title="Ukur Poligon"><i
                      class="bi bi-vector-pen"></i></button>
                  <div class="dropdown">
                    <button class="btn btn-light dropdown-toggle" type="button" id="basemap-dropdown"
                      data-bs-toggle="dropdown">
                      <i class="bi bi-map"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="basemap-dropdown">
                      <li><a class="dropdown-item" href="#" id="basemap-osm">OpenStreetMap</a></li>
                      <li><a class="dropdown-item" href="#" id="basemap-google-satellite">Google Satellite</a></li>
                      <li><a class="dropdown-item" href="#" id="basemap-google-terrain">Google Terrain</a></li>
                    </ul>
                  </div>
                </div>

                <div class="search-container">
                  <input type="text" id="search-input" placeholder="Cari..." />
                  <button id="search-button" class="btn btn-primary"><i class="bi bi-search"></i></button>
                </div>

                <div class="legend">
                  <h6>Legenda</h6>
                  <ul>
                    <li>
                      <span class="legend-icon" style="background-color: rgba(255, 255, 255, 0.5);"></span>
                      <span class="legend-label">Batas Administrasi</span>
                    </li>
                    <li>
                      <span class="legend-icon" style="background-color: rgba(38, 60, 133, 1);"></span>
                      <span class="legend-label">Data IMB</span>
                    </li>
                    <li>
                      <span class="legend-icon" style="background-color: rgba(255, 0, 0, 0.5);"></span>
                      <span class="legend-label">Pencarian</span>
                    </li>
                  </ul>
                </div>
                <div class="attribute-container">
                  <label for="attribute-select">Pilih Atribut:</label>
                  <select id="attribute-select">
                    <option value="Nama">Nama</option>
                    <option value="No_Sertif">No. Sertifikat</option>
                    <option value="Fungsi">Fungsi</option>
                    <!-- Tambahkan pilihan atribut lain jika diperlukan -->
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div><!-------- End Main Page -------->

      </div>

      <script
        src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
      <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v6.4.3/build/ol.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', function () {

          // --------------- Inisiasi Peta --------------
          var map = new ol.Map({
            target: 'map',
            layers: [
              new ol.layer.Tile({
                source: new ol.source.OSM()
              })
            ],
            view: new ol.View({
              center: ol.proj.fromLonLat([110.38310352425505, -7.795505117287234]),
              zoom: 13
            }),
            controls: []
          });
          // -------------- End Inisiasi Peta --------------




          // -------------- Control Button --------------
          var controlContainer = document.querySelector('.control-container');


          // -------------- Zoom In, Zoom Out dan Full Screen Button --------------
          var zoomInButton = controlContainer.querySelector('#zoom-in');
          zoomInButton.innerHTML = '<i class="bi bi-zoom-in"></i>';

          var zoomOutButton = controlContainer.querySelector('#zoom-out');
          zoomOutButton.innerHTML = '<i class="bi bi-zoom-out"></i>';

          var fullScreenButton = controlContainer.querySelector('#fullscreen');
          fullScreenButton.innerHTML = '<i class="bi bi-fullscreen"></i>';

          zoomInButton.addEventListener('click', function () {
            var view = map.getView();
            var zoom = view.getZoom();
            view.setZoom(zoom + 1);
          });

          zoomOutButton.addEventListener('click', function () {
            var view = map.getView();
            var zoom = view.getZoom();
            view.setZoom(zoom - 1);
          });

          fullScreenButton.addEventListener('click', function () {
            var element = document.getElementById('map');
            if (element.requestFullscreen) {
              element.requestFullscreen();
            } else if (element.mozRequestFullScreen) {
              element.mozRequestFullScreen();
            } else if (element.webkitRequestFullscreen) {
              element.webkitRequestFullscreen();
            } else if (element.msRequestFullscreen) {
              element.msRequestFullscreen();
            }
          });
          // -------------- End of Zoom In, Zoom Out dan Full Screen Button --------------


          // -------------- Geolocation Button --------------
          var geolocateButton = controlContainer.querySelector('#geolocate');
          geolocateButton.innerHTML = '<i class="bi bi-geo-alt"></i>';

          geolocateButton.addEventListener('click', function () {
            if ("geolocation" in navigator) {
              navigator.geolocation.getCurrentPosition(function (position) {
                var coords = ol.proj.fromLonLat([position.coords.longitude, position.coords.latitude]);
                map.getView().setCenter(coords);
                map.getView().setZoom(18);

                var vectorLayer = map.getLayers().item(1);
                if (vectorLayer) {
                  map.removeLayer(vectorLayer);
                }

                var marker = new ol.Feature({
                  geometry: new ol.geom.Point(coords)
                });

                var iconStyle = new ol.style.Style({
                  image: new ol.style.Icon({
                    src: 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/icons/geo-alt-fill.svg',
                    scale: 1.3,
                    color: 'rgb(38, 60, 133)'
                  })
                });

                marker.setStyle(iconStyle);

                var vectorSource = new ol.source.Vector({
                  features: [marker]
                });

                var vectorLayer = new ol.layer.Vector({
                  source: vectorSource
                });

                map.addLayer(vectorLayer);
              });
            } else {
              alert('Geolocation tidak didukung pada browser ini.');
            }
          });
          // -------------- End of Geolocation Button --------------


          // -------------- Basemap Button --------------
          var basemapOSM = controlContainer.querySelector('#basemap-osm');
          basemapOSM.addEventListener('click', function (evt) {
            map.getLayers().setAt(0, new ol.layer.Tile({
              source: new ol.source.OSM()
            }));
            clearActiveDropdownItems();
            basemapOSM.classList.add('active');
          });

          var basemapGoogleSatellite = controlContainer.querySelector('#basemap-google-satellite');
          basemapGoogleSatellite.addEventListener('click', function (evt) {
            map.getLayers().setAt(0, new ol.layer.Tile({
              source: new ol.source.XYZ({
                url: 'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',
                maxZoom: 19
              })
            }));
            clearActiveDropdownItems();
            basemapGoogleSatellite.classList.add('active');
          });

          var basemapGoogleTerrain = controlContainer.querySelector('#basemap-google-terrain');
          basemapGoogleTerrain.addEventListener('click', function (evt) {
            map.getLayers().setAt(0, new ol.layer.Tile({
              source: new ol.source.XYZ({
                url: 'https://mt1.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',
                maxZoom: 19
              })
            }));
            clearActiveDropdownItems();
            basemapGoogleTerrain.classList.add('active');
          });

          function clearActiveDropdownItems() {
            var dropdownItems = controlContainer.querySelectorAll('.dropdown-item');
            dropdownItems.forEach(function (item) {
              item.classList.remove('active');
            });
          }

          var dropdownToggles = controlContainer.querySelectorAll('.dropdown-toggle');
          dropdownToggles.forEach(function (dropdownToggle) {
            new bootstrap.Dropdown(dropdownToggle);
          });
          // -------------- End of Basemap Button --------------


          // -------------- End Control Button --------------

          // -------------- Search Button --------------
          document.addEventListener('DOMContentLoaded', function () {
            // ... Bagian lain dari kode Anda ...

            // Buat instance dari search control
            var searchControl = new ol.control.Search({
              layer: geojsonLayer.getSource(), // Gunakan layer geojsonLayer sebagai layer pencarian
              propertyName: 'Nama', // Ganti 'Nama' dengan atribut yang ingin Anda gunakan sebagai pencarian
              circleRadius: 5,
              collapsed: false,
              zoom: 14,
            });

            // Tambahkan search control ke peta
            map.addControl(searchControl);

            // Fungsi untuk menangani hasil pencarian yang dipilih
            searchControl.on('select', function (e) {
              if (e.search.feature) {
                var feature = e.search.feature;
                var featureStyle = feature.getStyle();
                feature.setStyle(new ol.style.Style({
                  fill: new ol.style.Fill({
                    color: 'rgba(255, 0, 0, 0.5)' // Warna poligon yang berbeda untuk hasil pencarian
                  }),
                  stroke: new ol.style.Stroke({
                    color: '#000000',
                    width: 2
                  })
                }));
                feature.set('highlighted', true);

                // Perbarui tampilan peta
                geojsonLayer.changed();

                // Tampilkan informasi di popup
                var properties = feature.getProperties();
                var selectedAttribute = document.getElementById('attribute-select').value;

                var attributeTable = '<table>';
                if (properties.hasOwnProperty(selectedAttribute)) {
                  attributeTable += '<tr><th>' + selectedAttribute + '</th><td>' + properties[selectedAttribute] + '</td></tr>';
                }
                attributeTable += '</table>';

                var coordinate = e.search.feature.getGeometry().getCoordinates();
                showPopup(attributeTable, coordinate);
              }
            });

            // ... Bagian lain dari kode Anda ...
          });

          // -------------- End of Search Button --------------


          // -------------- Add Data --------------
        



          // -------------- Data IMB --------------
          var vectorSource = new ol.source.Vector({
            url: 'assets/Data/data.geojson',
            format: new ol.format.GeoJSON()
          });

          var geojsonStyle = new ol.style.Style({
            fill: new ol.style.Fill({
              color: 'rgba(38, 60, 133, 1)'
            }),
            stroke: new ol.style.Stroke({
              color: '#000000',
              width: 2
            })
          });

          var geojsonLayer = new ol.layer.Vector({
            source: vectorSource,
            style: geojsonStyle
          });
          map.addLayer(geojsonLayer);

          // Menambahkan overlay untuk popup
          var popupOverlay = new ol.Overlay({
            element: document.getElementById('popup'),
            positioning: 'bottom-center',
            offset: [0, -10],
            stopEvent: false
          });
          map.addOverlay(popupOverlay);

          function showPopup(content, coordinate) {
            popupOverlay.setPosition(coordinate);
            document.getElementById('popup').innerHTML = content;
          }

          function getFeatureInfo(pixel) {
            var feature = map.forEachFeatureAtPixel(pixel, function (feature) {
              return feature;
            });

            if (feature) {
              var properties = feature.getProperties();
              var selectedAttribute = document.getElementById('attribute-select').value;

              var attributeTable = '<table>';
              if (properties.hasOwnProperty(selectedAttribute)) {
                attributeTable += '<tr><th>' + selectedAttribute + '</th><td>' + properties[selectedAttribute] + '</td></tr>';
              }
              attributeTable += '</table>';

              var coordinate = map.getCoordinateFromPixel(pixel);
              showPopup(attributeTable, coordinate);
            } else {
              popupOverlay.setPosition(undefined);
            }
          }

          // Menambahkan event listener untuk klik pada peta
          map.on('click', function (event) {
            var pixel = event.pixel;
            getFeatureInfo(pixel);
          });
        });
        // -------------- End of Data IMB --------------



      </script>
      </div>
    </section>

  </main><!-- End #main -->



  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.min.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
  <script src="assets\js\main_nice.js"></script>
  <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v6.4.3/build/ol.js"></script>
  <script
    src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.min.js"></script>
  <script src="https://unpkg.com/ol-ext/dist/ol-ext.min.js"></script>

</body>

</html>